#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” VÃ©rification des secrets..."

# VÃ©rifier les secrets Stripe et AWS dans les fichiers rÃ©els
for FILE in $(git diff --cached --name-only --diff-filter=ACM); do
  # Ignorer les fichiers de config Git
  case "$FILE" in
    .husky/pre-commit|commitlint.config.js)
      continue
      ;;
  esac
  
  # VÃ©rifier le contenu du fichier staged
  if git show ":$FILE" 2>/dev/null | grep -qE "(sk_live_[a-zA-Z0-9]{20,}|sk_test_[a-zA-Z0-9]{20,}|AKIA[0-9A-Z]{16})" 2>/dev/null; then
    echo "âŒ Erreur : Secret dÃ©tectÃ© dans $FILE"
    echo "   Secrets Stripe (sk_live_, sk_test_) ou AWS keys (AKIA...) ne doivent pas Ãªtre commitÃ©es"
    exit 1
  fi
done

echo "âœ… Aucun secret dÃ©tectÃ©"
exit 0
